{% if form_heading == nil %}
  {% assign form_heading = 'Customer Login' %}
{% endif %}
{% if container_id == nil %}
  {% assign container_id = 'customer-login' %}
{% endif %}
<!-- Customer Account Login -->

<div id="customer-login" class="register-login">

  <h1>{{form_heading}}</h1>

  <p id="success_pw" style="font-weight: bold;"></p>

  {% form 'customer_login', class: "ac-form--login"%}
  {{ form.errors | default_errors }}

  <div id="login_email" class="clearfix form-row">
    <label for="customer_email" class="login">email</label>
    <input type="email" value="" name="customer[email]" placeholder="Email Address" id="customer_email" class="large" size="30" />
  </div>

  {% if form.password_needed %}
  <div id="login_password" class="clearfix form-row ac-password__field">
    <label for="customer_password" class="login">Password</label>
    <input type="password" value="" name="customer[password]" placeholder="Password" id="customer_password" class="large password" size="16" />
  </div>
  <div class="register_wrap">
    <div id="forgot_password" class="ac-form__link">
      <a href="#" onclick="showRecoverPasswordForm(); return false">forgot password?</a>
    </div>
    <div id="forgot_password" class="ac-form__link">
      <p class="ac-text--fogot">don't have an account?</p>
    </div>
  </div>
  {% endif %}
   <div class="register_wrap">
    <div class="action-bottom">
      <button class="ac-form__btn ac-form__btn--black" type="submit">Sign In</button>
    </div>
    <div class="action-bottom">
      <a href="#" class="ac-form__btn ac-form__btn--solid" onclick="showRegisterForm(); return false">Register</a>
    </div>
   </div>
  {% endform %}
</div>

<style>
  .tingle-modal__close {
    width: 32px;
    height: 32px;
  }
  #customer-register {
    margin-top: 0!important;
  }
  .ac-form--login {
    min-width: 348px;
  }
  .ac-form__note {
    font-style: italic;
    font-weight: 400;
    font-size: 11px;
    line-height: 14px;
    text-transform: lowercase;
    color: #666666;
  }
  .ac-form__btn {
    background-color: transparent;
    border-color: transparent;
    color: #000;
    font-family: FuturaND;
    font-weight: 500;
    font-size: 14px;
    line-height: 18px;
    border-radius: 100px;
    min-width: 162px;
    display: inline-block;
    text-align: center;
    text-transform: uppercase;
    padding: 10px;
  }
  .ac-form__btn--black {
    background-color: #000;
    border-color: #000;
    color: #fefaf0;
  }

  .ac-form__btn--solid {
    border-color: #000;
  }
  .ac-form__selector {
    width: 100%;
  }
  .ac-text--fogot {
    margin: 0;
    font-size: 13px;
    letter-spacing: 0.05em;
  }
  .form-btn:hover {
    background: #FEFAF0;
    color: #000;
    opacity: 1;
  }
  .register_wrap {
    display: flex;
    justify-content: space-around;
    align-items: center;
  }
  .register-login.register-login h1 {
    margin-bottom: 24px;
  }
  .tingle-modal.login-register-alert-popup .tingle-modal-box.tingle-modal-box {
    max-width: 584px;
    padding: 94px 120px 120px;
    max-height: 600px;
    overflow-y: auto;
  }
  .tingle-modal.login-register-alert-popup .tingle-modal-box.tingle-modal-box__lg {
    max-width: 894px;
    padding-left: 90px;
    padding-right: 90px;
  }
  .ac-password__field.ac-password__field.ac-password__field {
    margin-bottom: 32px;
  }
  .ac-form__link {
    margin-top: 0!important;
    margin-bottom: 4px!important;
    margin-left: 24px!important;
  }
  .ac-form_feild.ac-form_feild.ac-form_feild {
    border: 1px solid black;
    border-radius: 5px;
    padding: 13px 15px 12px;
    height: 47px;
    background-color: transparent!important;
    box-shadow: none!important;
  }
  .register-login.register-login {
    float: none!important;
    width: 100%!important;
  }
  .tingle-modal-box.tingle-modal-box {
       padding-bottom: 85px!important;
  }
  /* Create account */
  .ac-form-title__wrap {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
  }
   .ac-form-title {
     margin-bottom: 0!important;
   }
    .ac-from__step {
    font-family: 'Futura ND';
    font-size: 12px;
    line-height: 16px;
    color: #666666;
    margin-bottom: 0;
  }
   .ac-from__step span {
     color: #FF6B26;
   }
  
  .register-form__fieldset {
    width: calc((100% - 20px)/2);
    margin-bottom: 30px!important;
  }
  .register-form__fieldset:nth-child(odd) {
    margin-right: 20px;
  }
  
  /*  Tabs  */
  #regForm {
  background-color: #ffffff;
  margin: 100px auto;
  padding: 40px;
  width: 70%;
  min-width: 300px;
}

/* Style the input fields */
input {
  padding: 10px;
  width: 100%;
  font-size: 17px;
  font-family: Raleway;
  border: 1px solid #aaaaaa;
}

/* Mark input boxes that gets an error on validation: */
input.invalid {
  background-color: #ffdddd;
}

/* Hide all steps by default: */
  .tab {
    display: none;
    flex-wrap: wrap;
    margin-bottom: 10px;
  }
  
  /* Make circles that indicate the steps of the form: */
  .step {
    height: 15px;
    width: 15px;
    margin: 0 2px;
    background-color: #bbbbbb;
    border: none;
    border-radius: 50%;
    display: inline-block;
    opacity: 0.5;
  }
  
  /* Mark the active step: */
  .step.active {
    opacity: 1;
  }
  
  /* Mark the steps that are finished and valid: */
  .step.finish {
    background-color: #04AA6D;
  }
</style>
<!-- Password Recovery -->

<div id="recover-password" class="register-login" >

  <h1>Reset Password</h1>


  <p class="note">We will send you an email to reset your password</p>

  <form id="resetPassword">
    {{ form.errors | default_errors }}
    {% if form.posted_successfully? %}
    <p class="note">You will receive an email with clear instructions</p>
    {% endif %}

    <div id="recover_email" class="clearfix large_form">
      <label for="email" class="large">Email</label>
      <input type="email" value="" size="30" placeholder="Email Address" name="email" id="recover-email" class="large" />
    </div>
    <div style="padding:10px 0;" id="resetPasswordMessage"></div>

    <div class="action-bottom">
      <input class="btn animation" type="submit" value="Submit" />
      <span class="note">or <a href="#" onclick="hideRecoverPasswordForm(); return false">Cancel</a></span>
    </div>
  </form>

</div>

    <div id="customer-register" style="display: none;" class="register-login" >
      <div class="ac-form-title__wrap">
        <h1 class="ac-form-title">Create Account</h1>
        <p class="ac-from__step">step <span class="js-step">1</span> of 3 </p>
      </div>
      {% form 'create_customer' %}
      {{ form.errors | default_errors }}
      <div id="step-first" class="tab">
        <div id="first_name-wrap" class="clearfix form-row register-form__fieldset">
          <label for="first_name" class="login">First Name*</label>
          <input type="text" value="{{ form.first_name }}" placeholder="First Name" name="customer[first_name]" id="first_name" class="large" size="30" required />
        </div>
  
        <div id="last_name-wrap" class="clearfix form-row register-form__fieldset">
          <label for="last_name" class="login">Last Name*</label>
          <input type="text" value="{{ form.last_name }}" placeholder="Last Name" name="customer[last_name]" id="last_name" class="large{% if form.errors contains 'last_name' %} error{% endif %}" size="30" required/>
        </div>

        <div id="password-wrap" class="clearfix form-row register-form__fieldset">
          <label for="password" class="login">Password*</label>
          <input type="password" value="" name="customer[password]" placeholder="Password" id="password" class="large password{% if form.errors contains 'password' %} error{% endif %}" size="30"required />
        </div>
  
        <div id="confirm-password-wrap" class="clearfix form-row register-form__fieldset">
          <label for="confirm-password" class="login">Confirm Password*</label>
          <input type="password" value="" name="customer[confirm-password]" placeholder="Password" id="confirm-password" class="large password{% if form.errors contains 'confirm-password' %} error{% endif %}" size="30"required />
        </div>

        <div id="email-wrap" class="clearfix form-row register-form__fieldset">
          <label for="email" class="login ac-text--truncate">Email* <span class="ac-form__note">identical to account email with primary distributor</span></label>
          <input type="email" value="{{ form.email }}" placeholder="Email Address" name="customer[email]" id="email" class="large{% if form.errors contains 'email' %} error{% endif %}" size="30" required/>
        </div>

        <div id="phone-wrap" class="clearfix form-row register-form__fieldset">
          <label for="phone" class="login">Mobile Number*</label>
          <input type="tel" value="" id="phone" class="large ac-form_feild {% if form.errors contains 'phone' %} error{% endif %}" size="30"required />
        </div>
        
      </div>
      
      <div id="step-second" class="tab">
        <div id="salon_name_wrap" class="clearfix form-row register-form__fieldset">
          <label for="salon_name" class="login">Salon Name*</label>
          <input type="text" value="{{ form.salon_name }}" placeholder="Salon Name" required name="customer[salon_name]" id="salon_name" class="large" size="30" />
        </div>
        <div id="country_wrap" class="clearfix form-row register-form__fieldset">
          <label for="country" class="login">Country*</label>
          {% render 'country_selector'%}
<!--      <input type="text" value="{{ form.country }}" placeholder="Country" name="customer[country]" id="country" class="large{% if form.errors contains 'country' %} error{% endif %}" size="30" /> -->
        </div>

<!--         <div id="salon_name_wrap" class="clearfix form-row register-form__fieldset"></div> -->

        <div id="salon-adress_wrap_1" class="clearfix form-row register-form__fieldset">
          <label for="salon-adress_1" class="login">Salon address line 1*</label>
          <input type="text" value="" name="customer[salon_address_1]" required placeholder="Salon address line 1" id="salon-adress_1" class="large{% if form.errors contains 'password' %} error{% endif %}" size="30"/>
        </div>

        <div id="salon-adress_wrap_2" class="clearfix form-row register-form__fieldset">
          <label for="salon-adress_2" class="login">Salon address line 2*</label>
          <input type="text" value="" name="customer[salon_address_2]" required placeholder="Salon address line 2" id="salon-adress_2" class="large password{% if form.errors contains '' %} error{% endif %}" size="30"/>
        </div>

        <div id="city_wrap" class="clearfix form-row register-form__fieldset">
          <label for="city" class="login">City*</label>
          <input type="text" value="" name="customer[city]" placeholder="city" required id="city" class="large {% if form.errors contains 'password' %} error{% endif %}" size="30" />
        </div>

        <div id="state_wrap" class="clearfix form-row register-form__fieldset">
          <label for="state" class="login">State/province*</label>
          <input type="text" value="{{ form.state }}" placeholder="state" required name="customer[state]" id="state" class="large{% if form.errors contains 'state' %} error{% endif %}" size="30" />
        </div>

        <div id="zip_wrap" class="clearfix form-row register-form__fieldset">
          <label for="zip" class="login">zip/postal code*</label>
          <input type="text" value="{{ form.zip }}" placeholder="zip/postal code" required name="customer[zip]" id="zip" class="large{% if form.errors contains 'zip' %} error{% endif %}" size="30"/>
        </div>
      </div>
      <style>
        .ac-form-distributor__description {
          font-size: 16px;
          line-height: 21px;
          color: #000;
          margin-bottom: 16px;
        }
        .ac-form-distributor__description--small {
          font-size: 14px;
          line-height: 18px;
          color: #000
        }
        .ac-form__checkbox {
          position: relative;
          display: inline-block;
          padding-left: 20px;
          font-size: 14px;
          line-height: 18px;
          color: #555;
          cursor: pointer;
        }
        .ac-form__checkbox input {
          position: absolute;
          opacity: 0;
          z-index: -1;
        }
        .ac-form__checkbox--small {
          width: 50%;
        }
        .ac-form-checkbox__note {
          font-size: 11px;
          line-height: 14px;
          color: #9B9B9B;
        }

        .ac-divider {
          width: 100%;
          border-color: #FF6B26;
          margin-top: 0;
          margin-bottom: 24px;
        }

        .ac-form__checkbox .control-indicator {
          border-radius: 1px;
        }
        .ac-form__checkbox input:checked ~ .control-indicator {
          background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNy4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4Ig0KCSB2aWV3Qm94PSIwIDAgOCA4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA4IDgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTYuNCwxTDUuNywxLjdMMi45LDQuNUwyLjEsMy43TDEuNCwzTDAsNC40bDAuNywwLjdsMS41LDEuNWwwLjcsMC43bDAuNy0wLjdsMy41LTMuNWwwLjctMC43TDYuNCwxTDYuNCwxeiINCgkvPg0KPC9zdmc+DQo=);
        }
        .ac-form__checkbox input:checked ~ .control-indicator {
          color: #fff;
          background-color: #FF6B26;
        }
        .ac-form__checkbox a {
          text-decoration: underline;
        }

        .control-indicator {
          position: absolute;
          top: 0.25rem;
          left: 0;
          display: block;
          border: 1px solid #FF6B26;
          width: 11px;
          height: 11px;
          line-height: 1rem;
          font-size: 65%;
          color: #eee;
          text-align: center;
          background-color: #eee;
          background-size: 50% 50%;
          background-position: center center;
          background-repeat: no-repeat;
          pointer-events: none;
          -webkit-user-select: none;
          -moz-user-select: none;
          -ms-user-select: none;
          user-select: none;
        }
        </style>
      <div id="step-third" class="tab">
        <p class="ac-form-distributor__description">salons can only earn rewards based on the purchase totals reported by their designated primary distributor as purchase totals cannot be combined.​ once submitted, this field is unable to be modified.</p>
         <div id="distributor_wrap" class="clearfix form-row register-form__fieldset">
            <label for="distributor" class="login ac-text--truncate">primary distributor name*</label>
            <input type="text" value="" name="customer[distributor]" required placeholder="primary distributor name" id="distributor" class="large {% if form.errors contains 'distributor' %} error{% endif %}" size="30" />
        </div>
        <p class="ac-form-distributor__description--small">salons can only earn rewards based on the purchase totals reported by their designated primary distributor as purchase totals cannot be combined.​ once submitted, this field is unable to be modified.</p>   
        <div id="distributor_wrap" class="clearfix form-row register-form__fieldset ac-offset-right--sm">
          <label for="distributor-salon" class="login ac-text--truncate">are you a Suite?* <span class="ac-form__note">(select yes or no)</span></label>
          <input type="text" value="" name="customer[distributor]" required placeholder="primary distributor name" id="distributor-salon" class="large {% if form.errors contains 'distributor' %} error{% endif %}" size="30" />
        </div>
        <style>
          .ac-offset-right--sm {
            margin-right: 20px!important;
          }
          .ac-upload__field {
            width: 100%;
            height: 47px;
            border: 1px dashed #000;
            border-radius: 5px;
            padding: 13px 15px 12px;
          }
          .ac-upload-field__input {
            font-weight: 400;
            font-size: 13px;
            line-height: 18px;
            color: #000;
          }
          .ac-upload-field__input i {
            font-style: italic;
            font-weight: 400;
            font-size: 13px;
            line-height: 16px;
          }
          .ac-upload__field #file-input{
            display:none;
          }
          
          .ac-upload__field label[for='file-input'] *{
            vertical-align:middle;
            cursor:pointer;
          }
          
          .ac-remove__btn {
            background-color: transparent;
            padding-left: 20px;
            cursor:pointer;
            font-style: normal;
            
            font-weight: 400;
            font-size: 12px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #000000;
          }
          .ac-upload-preview__image-wrap {
            max-width: 46px;
            height: 46px;
            overflow: hidden;
            border-radius: 5px;
          }
          .ac-upload-preview__image {
            height: auto;
            max-width: 100%;
          }
          .ac-upload__preview {
            dispaly: flex;
            justify-content: space-between;
          }
          .ac-upload__preview > div{
            display: inline-flex;
            align-items: center;
          }
          .ac-upload-preview__text {
            font-weight: 400;
            font-size: 14px;
            line-height: 18px;
            color: #000;
            margin-left: 12px;
          }
          input.invalid {
            border-color: red!important;
            background-color: #ffdddd!important;
          }
          .ac-upload__wrap{
             display: flex;
          }
          .ac-submit__wrap {
            display: flex;
          }
          .ac-text--truncate {
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
          }
        </style>
        <div class="clearfix form-row  register-form__fieldset">
          <label for="distributor" class="login ac-text--truncate">upload image of your business license*</label>
          <div class="ac-upload__field" data-upload-file> 
            <input type="file" required id="file-input">
            <label for="file-input" style="display: flex;" сlass="ac-upload__wrap"> 
              <span class="ac-upload-field__input ac-text--truncate">Choose file <i>(cosmetology license not accepted)</i></span>
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 4.16666V15.8333" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M4.16602 10H15.8327" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </label>
          </div>
          <div class="ac-upload__preview" style="display: none;" data-remove-img>
            <div>
              <div class="ac-upload-preview__image-wrap">
                <img class="ac-upload-preview__image " id="preview"/>
              </div>
              <span class="ac-upload-preview__text" data-upload-text></span>
            </div>
            <button class="ac-remove__btn" type="button">remove</button>
          </div>
        </div>
        <hr class="ac-divider">
        <label class="ac-form__checkbox ac-form__checkbox--small control checkbox">
          <input id="subscribe" type="checkbox" name="customer[subscribe]" value="">
          <span class="control-indicator"></span>
          <span class="ac-form__checkbox__text" id="">subscribe to get the latest updates from amika pro <span class="ac-form-checkbox__note">(optional)</span>
        </label>
        <label class="ac-form__checkbox ac-form__checkbox--small control checkbox">
          <input id="terms" type="checkbox" name="customer[terms]" value="">
          <span class="control-indicator"></span>
          <span class="ac-form__checkbox__text" id="">I agree to the program terms + conditions* <br><span class="ac-form-checkbox__note">Please read our terms here: <a href="" class="">terms and conditions</a></span>
        </label>
      </div>
        <div style="overflow:auto;">
          <div style="float:right;" class="ac-submit__wrap">
            <button class="ac-form__btn" type="button" id="cancelBtn" onclick="hideRecoverPasswordForm(); return false">Cancel</button>
            <button class="ac-form__btn " type="button" id="prevBtn" onclick="nextPrev(-1)">Back to step 1</button>
            <button class="ac-form__btn ac-form__btn--black" type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
            <button class="ac-form__btn ac-form__btn--black" type="button" id="submitBtn" onclick="submit(); return false">Submit</button>
          </div>
      </div>
      {% endform %}

    </div>

<script type="text/javascript">
$("#resetPassword").on('submit', function(e){
  e.preventDefault();
  $form = $(this);
  customerAccount.resetPassword($form.find('[name="email"]').val())
})


const customerAccount = {
  emailFailed: true, 
  validateEmail: function(emailAddress){
      let regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      let passed = regex.test(emailAddress);
      this.emailFailed = passed ? false : true;
      return passed; 
  },
  resetPassword: async function(email){
    let validEmail = this.validateEmail(email); 
    if(!validEmail){
      $('#resetPasswordMessage').html('<span class="error">Please enter a valid email address.</span>') 
      return;
    }else{
      $('#resetPasswordMessage').html('') 
    }

    let payload = {
      query: `mutation customerRecover($email: String!) {
        customerRecover(email: $email) {
          customerUserErrors { field, message, code }
        }
      }`,
      variables: {
        "email": email      
      }
    };
    
    let results = await fetch(`https://amika-pro.myshopify.com/api/2021-10/graphql.json`, {
      method: 'POST',
      headers: {
        "Content-Type": "application/json",
        'X-Shopify-Storefront-Access-Token': '1429b9687e3bacae6c679260935ad4cd',
      },
      body: JSON.stringify(payload)
    });

    await results.json().then(response => {
      if(!response.data) return false; 
      if(response.errors && response.errors.length > 0){ 
        $('#resetPasswordMessage').html(`<span class="error">${response.errors[0].message}</span>`) 
      }else{
        $('#resetPasswordMessage').html('<span class="success">Success! Please check your email for further instructions')
      }
    }).catch(error => {
      $('#resetPasswordMessage').html('<span class="error">There was an error when submitting your request.</span>') 
    })
  }
}


  if (window.location.hash == '#recover') { showRecoverPasswordForm() }
  if (window.location.hash == '#register') { showRegisterForm() }
  function registerFormFirst() {
    document.getElementById('recover-password').style.display = 'block';
    document.getElementById('customer-login').style.display='none';
  }
  function showRecoverPasswordForm() {
    document.getElementById('recover-password').style.display = 'block';
    document.getElementById('customer-login').style.display='none';
    window.location.hash = '#recover';
    return false;
  }
  function showRegisterForm() {
    document.querySelector('.tingle-modal-box').classList.add('tingle-modal-box__lg')
    document.getElementById('customer-register').style.display = 'block';
    document.getElementById('customer-login').style.display = 'none';
    document.getElementById('submitBtn').style.display='none';
    window.location.hash = '#register';
    return false;
  }

  function hideRecoverPasswordForm() {
    document.getElementById('recover-password').style.display = 'none';
    document.getElementById('customer-register').style.display='none';
    document.getElementById('customer-login').style.display = 'block';
    window.location.hash = '';
    return false;
  }

  $(window).load(function() {
    var message = $('.success_pw').html();
    $('#success_pw').html(message);
  });

  // Contact tabs

  var currentTab = 0; // Current tab is set to be the first tab (0)
  

  showTab(currentTab); // Display the current tab
  console.log('currentTab:', currentTab);
  
  function showTab(n) {
    // This function will display the specified tab of the form ...
    var x = document.getElementsByClassName("tab");
    if (n <3) {
      x[n].style.display = "flex";
    } else {
      x[n].style.display = "none";
    }
    // ... and fix the Previous/Next buttons:
    if (n == 0) {
      document.getElementById("prevBtn").style.display = "none";
      document.getElementById("cancelBtn").style.display = "inline";
      document.querySelector('.js-step').innerHTML = n+1;
    } else if (n < 3){
      document.getElementById("cancelBtn").style.display = "none";
      document.getElementById("prevBtn").style.display = "inline";
      document.getElementById("prevBtn").innerHTML = `back to step ${n}`;
      document.querySelector('.js-step').innerHTML = n+1;
      
    } 
    if (n == (2)) {
     // (x.length - 1)
      document.getElementById("nextBtn").style.display = "none";
      document.getElementById('submitBtn').style.display='block';
    } else {
      document.getElementById("nextBtn").innerHTML = "Next";
    }
    // ... and run a function that displays the correct step indicator:
    // fixStepIndicator(n)
  }
  
  function nextPrev(n) {
    // This function will figure out which tab to display
    var x = document.getElementsByClassName("tab");

    // Exit the function if any field in the current tab is invalid:
    // if (n == 1 && !validateForm()) {
    //   console.log('not validate')
    //   return false;
    // }
    // Hide the current tab:
    x[currentTab].style.display = "none";
    // Increase or decrease the current tab by 1:
    currentTab = currentTab + n;
    // if you have reached the end of the form... :

    if (currentTab >= x.length) {
      //...the form gets submitted:
      document.getElementById("create_customer").submit();
      console.log('submit')
      return false;
    }
    showTab(currentTab);
  }
  
  function validateForm() {
    // This function deals with validation of the form fields
    var x, y, i, valid = true;
    x = document.getElementsByClassName("tab");
    y = x[currentTab].querySelectorAll("[required]");
    // A loop that checks every input field in the current tab:
    for (i = 0; i < y.length; i++) {
      // If a field is empty...
      if (y[i].value == "") {
        // add an "invalid" class to the field:
        y[i].className += " invalid";
        // and set the current valid status to false:
        valid = false;
      }
    }
    // If the valid status is true, mark the step as finished and valid:
    // if (valid) {
    //   document.getElementsByClassName("step")[currentTab].className += " finish";
    // }
    return valid; // return the valid status
  }
  
  // function fixStepIndicator(n) {
  //   // This function removes the "active" class of all steps...
  //   var i, x = document.getElementsByClassName("step");
  //   for (i = 0; i < x.length; i++) {
  //     x[i].className = x[i].className.replace(" active", "");
  //   }
  //   //... and adds the "active" class to the current step:
  //   x[n].className += " active";
  // }

  // Upload function
  document.addEventListener("DOMContentLoaded", () => {
  const file = document.getElementById("file-input");
  const label = file.nextElementSibling;
  const labelText = document.querySelector("[data-upload-text]");
  const labelRemove = document.querySelector("[data-remove-img]");
  const uploadWrap = document.querySelector("[data-upload-file]");
  const labelDefault = labelText.textContent;
  const preview = document.getElementById("preview");
    
  // on file change
  file.addEventListener("change", (event) => {
    const fileName = file.value.split("\\").pop();
    if (fileName) {
      console.log(file);
      labelText.textContent = fileName;
      labelRemove.style.display = "flex";

      const reader = new FileReader();
      reader.onload = (e) => {
        preview.setAttribute("src", e.target.result);
        preview.style.display = "block";
        uploadWrap.style.display = "none";
      };
      reader.readAsDataURL(file.files[0]);
    } else {
      labelText.textContent = labelDefault;
      labelRemove.style.display = "none";
      preview.style.display = "none";
      uploadWrap.style.display = "block";
    }
  });

  // Remove file
    labelRemove.addEventListener("click", (event) => {
    file.value = "";
    labelText.textContent = labelDefault;
    labelRemove.style.display = "none";
    preview.style.display = "none";
    uploadWrap.style.display = "block";
    console.log(file);
  });
});
</script>
